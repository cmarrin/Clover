/*-------------------------------------------------------------------------
    This source file is a part of Clover
    For the latest info, see https://github.com/cmarrin/Clover
    Copyright (c) 2021-2022, Chris Marrin
    All rights reserved.
    Use of this source code is governed by the MIT license that can be
    found in the LICENSE file.
-------------------------------------------------------------------------*/

// Test constants, vars, operands and expressions

struct Test
{

const uint8 TestSizeDef = 12;
const int16 TestIntConst = 0xfc;
const float TestFloatConst = 3.5;

const int8 testIntTable[ ] = { 1, 2, 3, 7 };

const float testFloatTable [ ] = { 1.5, 2.5, 3.5, 7.5, };

int16 testIntGlobal;

function showIntResults(uint8 testNo, int32 exp, int32 act)
{
    core.printf("%10sTest %2hhi: ", " ", testNo);
    if (exp != act) {
        core.printf("     FAIL: exp %i, got %i\n", exp, act);
    } else {
        core.printf("     Pass\n");
    }
}

function showFloatResults(uint8 testNo, float exp, float act)
{
    core.printf("%10sTest %2hhi: ", " ", testNo);
    if (exp != act) {
        core.printf("     FAIL: exp %f, got %f\n", exp, act);
    } else {
        core.printf("     Pass\n");
    }
}

float testFloatGlobal;

initialize()
{    
    testIntGlobal = 42;
    testFloatGlobal = 6.5;

    core.printf("\nTest exprs\n");

    core.printf("\nTest Int vals\n");
    showIntResults(1, 12, TestSizeDef);
    showIntResults(2, 0xfc, TestIntConst);
    showIntResults(3, 7, testIntTable[3]);
    
    core.printf("\nTest Int ops\n");
    showIntResults(4, 294, TestIntConst + testIntGlobal);
    showIntResults(5, 210, TestIntConst - testIntGlobal);
    showIntResults(6, 10584, TestIntConst * testIntGlobal);
    showIntResults(7, 6, TestIntConst / testIntGlobal);
    
    showIntResults(8, -42, -testIntGlobal);
    showIntResults(9, 0, !TestIntConst);
    showIntResults(10, 0xffffff03, ~TestIntConst);
    
    showIntResults(11, 0, TestIntConst < testIntGlobal);
    showIntResults(12, 0, TestIntConst <= testIntGlobal);
    showIntResults(13, 0, TestIntConst == testIntGlobal);
    showIntResults(14, 1, TestIntConst != testIntGlobal);
    showIntResults(15, 1, TestIntConst >= testIntGlobal);
    showIntResults(16, 1, TestIntConst > testIntGlobal);
    
    int8 i = 20;
    int8 j = i++;

    showIntResults(17, 21, i);
    showIntResults(18, 20, j);
    j = i--;
    showIntResults(19, 20, i);
    showIntResults(20, 21, j);
    j = ++i;
    showIntResults(21, 21, i);
    showIntResults(22, 21, j);
    j = --i;
    showIntResults(23, 20, i);
    showIntResults(24, 20, j);

    core.printf("\nTest Int exprs\n");
    showIntResults(25, 2984, int16(testIntTable[1]) + int16(TestSizeDef) * TestIntConst - testIntGlobal);
    showIntResults(26, 2940, int16(testIntTable[1] + TestSizeDef) * (TestIntConst - testIntGlobal));

    core.printf("\nTest Float ops\n");
    showFloatResults(27, 10, TestFloatConst + testFloatGlobal);
    showFloatResults(28, -3, TestFloatConst - testFloatGlobal);
    showFloatResults(29, 22.75, TestFloatConst * testFloatGlobal);
    showFloatResults(30, 2.5, 16.25 / testFloatGlobal);

    showFloatResults(31, -6.5, -testFloatGlobal);

    showIntResults(32, 1, TestFloatConst < testFloatGlobal);
    showIntResults(33, 1, TestFloatConst <= testFloatGlobal);
    showIntResults(34, 0, TestFloatConst == testFloatGlobal);
    showIntResults(35, 1, TestFloatConst != testFloatGlobal);
    showIntResults(36, 0, TestFloatConst >= testFloatGlobal);
    showIntResults(37, 0, TestFloatConst > testFloatGlobal);
    
    core.printf("\nTest Float exprs\n");
    showFloatResults(38, 38, testFloatTable[1] + float(TestSizeDef) * TestFloatConst - testFloatGlobal);
    showFloatResults(39, -43.5, (testFloatTable[1] + float(TestSizeDef)) * (TestFloatConst - testFloatGlobal));

    core.printf("\nDone\n\n");
}

};
